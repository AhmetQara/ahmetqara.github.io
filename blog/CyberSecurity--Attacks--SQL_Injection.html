<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>SQL Injection</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><br /><strong><span style="color:#e01b24;">SQL Injection</span></strong><br /><br />Sql Injection&#39;a geçmeden önce biraz sql kodları üzerinde örneklere bakalım;<br /><br /><img src="images/71-1.png" alt="images/71-1.png" /><br /><br /><img src="images/71-2.png" alt="images/71-2.png" /> Bu komut ile virtualBox da açtığımız metasploitable makinasına linux üzerinden sql database e erişiyoruz. Normalde bu komuttan sonra şifre istemesi lazım fakat bu makinada bilerek bu kısmı açık ve şifresiz bırakmışlar. <br />  Bu komuttan sonra artık metasploitable makinasının data base&#39;ine eriştik;<br /><br /><img src="images/71-3.png" alt="images/71-3.png" /><br /><br />Şimdi “show databases;” komutu ile içerde olan veri tabanı tablolarını görelim;<br /><br /><img src="images/71-4.png" alt="images/71-4.png" />işte bunlar bu makinada bulunan database&#39;ler.<br /><br /><br />Bunlardan mesela “owasp10” database&#39;ini seçelim;<br /><br /><img src="images/71-5.png" alt="images/71-5.png" /><br /><br />&quot;<span style="color:#57e389;">use owasp10</span>&quot; komutu ile mysql database&#39;ine geçiş yaptık. use &lt;database_name&gt;<br /><br /><br />owasp10 içerisinde ki tabloları görelim;<br /><br /><img src="images/71-6.png" alt="images/71-6.png" />&quot;<span style="color:#57e389;">show tables;</span>&quot; komutu ile tabloları görebildik.<br /><br />Şimdi bir tablo seçip onun içine bakalım;<br /><br /><img src="images/71-7.png" alt="images/71-7.png" />&quot;credit_cards&quot; tablosunda ki bütün bilgileri “<span style="color:#57e389;">select * from credit_cards</span>” komutunu girerek listeledik.<br /><br /> Şimdi gelelim asıl önemli olan kısıma. Örneğin bir siteye giriş yaparken verilen kullanıcı adı, şifre gibi bilgileri yanlış girdiğimize bize gösterilen hata mesajına göre bir açık bulabiliriz ve bu açıktan faydalanabiliriz. <br /> <br /> Bu duruma bir örnek olarak;<br /> <br /> <img src="images/71-8.png" alt="images/71-8.png" /><br />  <br />  bu sitede şifre kısmına tek tırnak olan &#39; işaretini koydum ve site bu hatayı karşıma çıkarttı. Bu hatada özellikle kırmızı ile işaretlenen kısıma dikkat et, “<span style="color:#57e389;">select * FROM accounts..</span>” şeklinde gösterilen yerden anlaşılacağı gibi “<span style="color:#57e389;">accounts</span>” diye bir tablo bulunduğu bilgisini böylelikle edinmiş olduk. Şimdi bu tarz bilgiler sayesinde, bu tarz açıklardan nasıl bir şekilde faydalanıp kullanabiliriz onu görelim. <br /><br /><img src="images/71-9.png" alt="images/71-9.png" /><br /><br /><br />  bizim ilgilendiğimiz kısım bu SQL kodu. Bunun mesela <img src="images/71-10.png" alt="images/71-10.png" />password kısmına kendi passwordumuzu ve <span style="color:#57e389;">AND</span> <span style="color:#57e389;">1=1#&#39;</span> yazıp yani AND kısmından sonra doğru olacak bir logic yazıp (resimde görülen kırmızı ile altı çizili kısım), bunu alıp kopyayalıp şifre kısmına girip bu şekilde giriş yaptığımızda eğer çalışıyorsa bu şu demek oluyor; biz şifremizle birlikte aslında SQL kodu da yazarak çalıştırabiliyoruz, işte bu ve bunun gibi form göndererek sql kodu çalıştırma yöntemine <span style="color:#e01b24;">SQL Injection</span> deniyor. SQL Injection için genelde AND ve sonrasında istediğimiz bir kod ve en sonunda da # koymamız yani # işareti ile kapatmamız gerekir. Resimde işaretli kısımda ki örnekte olduğu gibi biz bu durumda password kısmına hem şifremizi hem de çalıştıracağımız kodu yapıştırıyoruz, bu örnekte olan durumda password kısmına şunu yapıştırmamız gerek;  <span style="color:#57e389;">111111&#39; AND 1=1#</span><br />  <br />  Eğer şifreyi bu şekilde “<span style="color:#57e389;">111111&#39; AND 1=1#</span>” girdiğimizde giriş yapılıyorsa demek ki SQL kodu çalışıyor. Şimdi bunu admin kullanıcısı olarak deneyelim;<br />  <br />  <img src="images/71-11.png" alt="images/71-11.png" /><br />  <br />  name için admin, şifre için bu sefer AND değil OR kullandık çünkü şifre ‘1’ ise VEYA (OR) 1=1 doğru ise giriş yap demiş olduk. E 1=1 doğru olduğuna göre bu şekilde ki bir SQL injection doğru kabul edeceği için admin şifresini bilmemize bile gerek kalmadan girmiş olduk. username için ya da bu örnekte olduğu gibi Name için admin girmeyi unutmuyoruz ki admin olarak giriş yapabilelim. Şifre kısmına tam olarak resimde de <strong><span style="background-color:#3584e4;">mavi şekilde seçili</span></strong> olan kısım  “1&#39; OR 1=1#&quot; (çift tırnaklar hariç) bu şekilde girdik. Yani password isimli değişkenin içini atıyoruz. <br />  password=&#39;içi&#39; →  <strong><span style="background-color:#3584e4;">mavi şekilde seçili</span></strong> kısmı yukarıda ki forma bulunan password kısmına yaz <img src="images/71-12.png" alt="images/71-12.png" /><br />  <br />  <img src="images/71-13.png" alt="images/71-13.png" /><br />  <br />  Benzer olarak birde bu yöntem var. Burda öncekinden farklı olarak sadece “<span style="color:#57e389;">admin</span>” username yani kullanıcı adı için sonuna # işareti koyduk. Bu şu demek oluyor, # bu işaretten sonra ki kodların hiç bir önemi yok! Eğer “<span style="color:#57e389;">admin</span>” isimli bir kullanıcı varsa şifresinin ne olduğundan bağımsız (resimde ki altı çizili ve 2 yazan kısımda ki şifrenin hiç bir önemi yok öylesine yazıldı) olarak bu SQL injection&#39;ı admin kullanıcısı için yap ve sisteme gir!<br />  <br /><br />  <br />  <img src="images/71-14.png" alt="images/71-14.png" /> <br />  <br />  Name kısmına girip admin&#39;# (&#39; işaretini koymayı da unutma) yazıp şifre kısmına ne yazarsak yazalım artık admin olarak Login olabiliriz.<br />  <br />  Bu gösterilen yöntemler SQL Injection yapabildiğimizi fark ettiğimizde ilk denememiz gereken yöntemlerdendir.<br /><br />  <strong><span style="color:#e01b24;">Get Metodu ile SQL Injection</span></strong><br />  <br />  Bir örnek üzerinden gidelim;<br />  <br />  <img src="images/71-15.png" alt="images/71-15.png" /><br />  <br />  bu sitenin kullanıcıların hesapları ile ilgili bilgi verdiği kısım. Şimdi burada bilerek yanlış bir name and password girelim;<br />  <br />  <img src="images/71-16.png" alt="images/71-16.png" /><br />  <br />  yanlış bir name and password girdiğimizde URL kısmının değiştiğini görüyoruz. O zaman biz bu URL kısmında bazı değişiklikler yaparak kendi istediğimiz bir kodu çalıştırarak SQL Injection yapabilir miyiz deneyelim;<br />  <br />  <br />  URL kısmında ki adresi şu şekilde,<br />  <br /><img src="images/71-17.png" alt="images/71-17.png" /> <br /><br />  şimdi bu adreste olan username kısmında ki “<span style="color:#57e389;">aaa</span>” diye girdiğimiz kısmın sonuna <span style="color:#57e389;">&#39;</span> ve <span style="color:#57e389;">#</span> işaretlerini koyalım (önceki örnekte olduğu gibi) ve bu şekilde Name kısmına yapıştıralım yani tam olarak şu şekilde <span style="color:#57e389;">aaa&#39;#</span><br /><br /><br /><img src="images/71-18.png" alt="images/71-18.png" /><br /><br /> şimdi bu değişen kısmı URL yapıştırıp çalıştıralım. <br /><br /> Çalıştırdıktan sonra sayfada bir değişiklik olmadı, demek ki bu metod çalışmıyor veya bir yanlış yaptık. <br /> <br /> Aslında burada ki yanlış şuydu;<br /> <br />  biz URL kısmına <span style="color:#57e389;"># </span>koyduğumuzda HTML koduna çevrilmedi, biz <span style="color:#57e389;">#</span> kısmının HTML koduna çevrilmesi için <span style="color:#57e389;">#</span> yerine <span style="color:#57e389;">%23</span> yazmalıyız.<br /><br /><img src="images/71-19.png" alt="images/71-19.png" /><br /><br />  yani bu şekilde <span style="color:#57e389;">#</span> yerine <span style="color:#57e389;">%23</span> yazdık. Şimdi bu haliyle çalıştırmadan önce “<span style="color:#57e389;">aaa</span>” gibi büyük ihtimalle sistemde bulunmayan bir <span style="color:#57e389;">username</span> yerine <span style="color:#57e389;">admin</span> yazarak URL kısmına yapıştıracağımız linki son haline getirelim. <br />  <br />  <img src="images/71-20.png" alt="images/71-20.png" /><br />  <br />  şimdi kullanıcı adını da “<span style="color:#57e389;">admin</span>” olarak değiştirdiğimize göre artık URL kısmına bunu yapıştırıp çalıştıralım.<br />  <br />  <img src="images/71-21.png" alt="images/71-21.png" />Çalıştırdıktan sonra gördümüz gibi <span style="color:#57e389;">admin</span>, <span style="color:#57e389;">şifresi</span>, <span style="color:#57e389;">signature</span>(imzası) olarak bilgilerini öğrenmiş olduk.<br />  <br />  İşte URL kısmında bir parametre görürsek, get metodu ile URL üzerinde yaptığımız değişikliklerle <span style="color:#e01b24;">get metodu ile Sql Injection</span> bu şekilde yapılıyor.<br />  <br />  Şimdi işi bir adım daha ileri götürelim. Örneğin bir siteye girmeye çalışıyoruz ve doğal olarak o sitenin veri tabanında (database) bulunan kullanıcı isimlerini bilmiyoruz hatta admin kullanıcı adını kullanarak get metodu ile sql injection gibi denemeler yaptık ama baktık ki kullanıcı adı olarak admin yok sonuçta yöneticinin kullanıcı admin olmak zorunda değil. Bu tarz durumlar için SQL dilinde bulunan “<span style="color:#57e389;">UNION</span>” yani “birleştirme” kodunu kullanarak iki tane SQL sorgusunu birden injection edeceğiz.<br />  <br />  <img src="images/71-22.png" alt="images/71-22.png" /><br />  <br />  burda da görüldüğü gibi UNION ile iki tane SQL sorgusunu birleştirdik. <br />  <br />  <br />  Bunu URL kısmına şu şekilde yazıyoruz;<br />  <br />  <br />  <img src="images/71-23.png" alt="images/71-23.png" /><br />  <br />  &lt;&#39;union select * from accounts&gt; yani kullanıcı adı olarak admin diye bi kullanıcı olsa da olmasa da git accounts tablosunda ki bütün kullanıcıları,şifreleri vs her şey bana göster demiş olduk.<br />  <br />  <img src="images/71-24.png" alt="images/71-24.png" /><br />  <br />  username kısmına yazdığıma dikkat et, olmayan bir kullanıcı yazdığımız halde çalışacak.<br />  <br />  Sonuç;<br />  <br />  <img src="images/71-25.png" alt="images/71-25.png" /><br />  <br />  sonuç bu. Admin de dahil bütün kullanıcıların bilgilerini aldık. Hem de şifreyi bırak, login olmadan, sistemde ki tek bir kullanıcı adını bile bilmeden.<br />  <br />  Şimdi burdada şöyle bir sorun çıkıyor, kullanıcı adını bilmeden bunu yaptık fakat bu kısımda “accounts” tablosunu kullanarak bu bilgiyi edindik. Eğer biz “accounts” isimli bir tablonun olduğunu bilmeseydik o zaman nasıl yapabilirdik? Şimdi ise bu soruyu cevaplayalım.<br />  <br />  <br />  <img src="images/71-26.png" alt="images/71-26.png" /><br />  <br />  üstte ki satırda olan “UNITON SELECT * FROM accounts...” kısmı önceden yazdığımız ve “accounts” tablo ismini bilerek yazdığımız kod.<br />  <br />  Bi alt satırda ki altı kırmızı ile işaretli olan kısımda da gösterildiği gibi “ORDER BY 1” olarak değiştirdik. ORDER BY verilen değere göre veri tabanında ki bi sütunları sıralamamıza yarayan bir keyword. Şimdi mesela ORDER BY 10 diyip bunu URL kısmında çalıştırmamız şu demek olacak; 10 tane sütun varsa onları bana sırala. Bunu deneyelim;<br />  <br />  <img src="images/71-27.png" alt="images/71-27.png" /> <br />  <br />  url kısmında işaretli şekilde çalıştırdığımızda aşağıda ki mesajda olan “böyle bir (bu kadar sayıda) sütun yok” hatasını aldık. Demek ki 10&#39;dan daha az sütun varmış. Sayıyı azaltarak deneme yanılmayla ilerleyip doğru sütun sayısını buluyoruz.<br />  <br />  <br />  <img src="images/71-28.png" alt="images/71-28.png" /><br />  <br />  sütun değerinin 5 olduğunu buluyoruz çünkü bir hata almadık ama şu durumda da bir bilgi veya değer de edinemedik ama en azından 5 tane sütun olduğunu anlamış olduk. <br />  <br />  <br />  Madem 5 sütun olduğunu bulduk o zaman UNION SELECT ile bu 5 sütunu seçelim;<br />  <br />  <br />  <img src="images/71-29.png" alt="images/71-29.png" /> <br />  <br />  bu şekilde seçiyoruz ve URL kısmına şu şekilde giriyoruz;<br />  <br />  <br />  <img src="images/71-30.png" alt="images/71-30.png" /> <br />  <br />  url kısmında kodu çalıştırınca aşağıda ki sonucu elde ediyoruz. Burda da görüldüğü gibi biz 1,2,3,4,5 girmemize rağmen bize 2,3,4 değerlerini döndürdü demek ki 2,3,4 kısmında ORDER BY kullanmamız daha mantıklı çünkü 1,5 ile ilgili mantıklı bir değer döndürmedi. O zaman biz 2,3,4 için istediğimiz bir değeri verip çalıştırırsak bu sayede istediğimiz değeri görebiliriz. <br />  <br />  <br />  Biz database i arıyoruz madem o zaman 2,3,4 değerleri yerine başka şeyler yazıp deneyelim. <br />  <br />  <br />  <img src="images/71-31.png" alt="images/71-31.png" /><br />  <br />  2,3,4 çalıştığı için gidip 2,3,4 yerine database(),user(),version() gibi değerler yazdık ve resimde de görüldüğü gibi gerçekten de çalıştı ve bize bu değerleri gösterdi. <br />  <br />  <br />  <img src="images/71-32.png" alt="images/71-32.png" />NOT: burada ki username,password,signature kısımlarının karşısında çıkan değerler doğru eşleşmedi çünkü biz bunları değil de bizim istediğimiz database(),user(),version() değerlerini URL kısmında verdiğimiz için username,password,signature kısımlarının karşısında database(),user(),version() değerleri çıktı. Yani burda ki username,password,signature yazmasının bir önemi yok. owasp10, root@localhost gibi bilgileri edinmemiz önemliydi ve edindik, yani istesek gerçekten de username karşısına username() getirmeyi deneyebilirdik, biz durda çalışıp çalışmadığını denemek için öylesine database(),user(),version() değerlerini verdik ve karşılığında da onlar çıktı ve çalıştığını görmüş olduk.<br />  <br />  Şimdi gelelim asıl amacımız olan tablo isimlerini bulmaya.<br />  <br /><img src="images/71-33.png" alt="images/71-33.png" /> bu şekilde bir sorgu ile her sql database dosyasında bulunan ve resimde de altı çizili gösterilen “information_schema” dosyasında ki bütün tabloları aratabiliriz. Şimdi bunu URL adresine koyup çalıştıralım. <br /><br /><img src="images/71-34.png" alt="images/71-34.png" /> <br /><br />Bütün veri tabanını tarayıp 237 tane tablo karşımıza çıkarttı. Biz aradığımız veri tabanı ismimlerinden birini “database()” yazarak &quot;owasp10&quot; olarak görmüştük, bunu kullanıp aramamızı daha spesifik bir hale getirebiliriz.<br /><br /><br /><img src="images/71-35.png" alt="images/71-35.png" /><br /><br />owasp10 database&#39;inde bulunan tabloları sıralamak için bu şekilde yazabiliriz.<br /><br /><br /><img src="images/71-36.png" alt="images/71-36.png" /><br /><br /> İşte artık ismini öğrendiğimiz bir database de bulunan bütün tabloları da görmeyi başardık. Şimdi madem tabloları gördük şimdi bu yönteme benzer şekilde birde yapmışken bu bulduğumuz tablonun içinde ki sütunları yani column ları da görelim;<br /> <br /> <img src="images/71-37.png" alt="images/71-37.png" /><br /> <br /> bu şekilde URL&#39;e yazalım;<br /> <br /> <br /> <img src="images/71-38.png" alt="images/71-38.png" /><br /> <br /> accounts tablosunda ki sütun isimlerini de ele geçirdik. <br /> <br /> <br /> Artık hem tablo hemde sütun (column) isimlerini gördüğümüze göre buna göre bir arama yapıp bütün her şeyi görebiliriz;<br /> <br /> <br /> <img src="images/71-39.png" alt="images/71-39.png" /><br /> <br /> <br /> <img src="images/71-40.png" alt="images/71-40.png" /> <br /> <br /> böylelikle her bir bilgiyi gördük ve ele geçirdik.<br /> <br /> <br /> NOT: aşağıda ki resimde, önceki sorgularda ki farkları belirtmek için kırmızı ok ile çizip değişimlerini gösterdim.<br /> <br /> <img src="images/71-41.png" alt="images/71-41.png" /><br /> <br /> <img src="images/71-42.png" alt="images/71-42.png" /><br /> <br /> <br /> Böylelikle <span style="color:#e01b24;">SQL Injection</span> sayesinde siteye giriş bile yapmadan bütün database i elegeçirdik.<br /> <br /> Bu kısımda öğrendiklerimizin hepsi işin arka planını anlamak içindi. Mantığını anladığımıza göre, bütün bu manuel olarak yaptığımız işleri bizim için site üzerinde (URL vererek) tarama yapıp, SQL Injection yapabileceğimiz bir açık var mı? Varsa database i görmemizi, içeriğini incelememizi vs sağlayan, bütün bunları <strong>otomatik</strong> olarak yapan bir framework var; <a href="CyberSecurity--Attacks--SQL_Map.html">SQL Map</a> <br /> </div>
</body>
</html>
